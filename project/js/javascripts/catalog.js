$.fn.attachPopup=function(popupSelector,config){config=config||{};var $link=$(this),$popup=$(popupSelector),timer,beforeOpen=config.beforeOpen||function(){return true},afterClose=config.afterClose||function(){return true},timeout=config.timeout||1E3,resetTimer=function(){clearTimeout(timer)},close=function(){resetTimer();$popup.hide();afterClose($link)},delayedClose=function(){timer=setTimeout(close,timeout)},open=function(){$popup.show()};$popup.hide().css("position","absolute").mouseenter(resetTimer).mouseleave(delayedClose);
$popup.find(".popop-title a").click(function(){close();return false});$link.click(function(){var res=beforeOpen($link,$popup);if(res!=undefined&&!res)return false;open();return false});return $(this)};var Catalog={filters:["new-releases","best-sellers","top-trades","top-rentals","coming-soon"],filtersObject:null,init:function(){Catalog.filtersObject={};for(var i=0;i<Catalog.filters.length;++i)Catalog.filtersObject[Catalog.filters[i]]=""},createCatalogNode:function(item){var id=item.id||0,short_name=item.short_name||"",name=item.name||"",href=item.url||"#",cover=item.cover||null,actions=item.actions||[];var node=$($.DIV({Class:"catalog-item-record"},$.DIV({Class:"catalog-item-cover empty"},$.A({title:name,
href:href},short_name)),$.DIV({Class:"catalog-item-title"},$.A({title:name,href:href},short_name),$.DIV({Class:"catalog-item-title-overlay"})),$.DIV({Class:"catalog-item-actions"})));if(item.category)node.find(".catalog-item-actions").before($.DIV({Class:"catalog-item-category"},item.category));if(item.price){node.find(".catalog-item-actions").before($.DIV({Class:"catalog-item-price"},$.SPAN({},item.price)));if(item.pre_owned)node.find(".catalog-item-price span").addClass("pre_owned")}if(item.rent_status){node.find(".catalog-item-actions").before($.DIV({Class:"catalog-item-rent-status"},
$.SPAN({},item.rent_status)));if(item.is_top_rental)node.find(".catalog-item-rent-status span").addClass("top-rentals")}if(item.trade_value){node.find(".catalog-item-actions").before($.DIV({Class:"catalog-item-trade-value"},$.SPAN({},item.trade_value)));if(item.is_hot_trade)node.find(".catalog-item-trade-value span").addClass("hot-trade")}if(cover){var cover_div=node.find(".catalog-item-cover");cover_div.removeClass("empty");cover_div.find("a").empty().append($.IMG({src:cover,width:item.cover_w||
140,height:item.cover_h||190}))}var d=node.find(".catalog-item-actions");if(actions.buy)d.append($.A({href:actions.buy,Class:"link-dialog catalog-item-action-buy",title:"Buy"},"Buy"));if(actions.trade)d.append($.A({href:actions.trade,Class:"link-dialog catalog-item-action-trade",title:"Trade"},"Trade"));if(actions.rent)d.append($.A({href:actions.rent,Class:"link-dialog catalog-item-action-rent",title:"Rent"},"Rent"));return node},showLoadedItems:function(items){var catalog_grid_content=$("#catalog-grid-content");
var ul=catalog_grid_content.find("ul.catalog-items");ul.empty();if(items.length)ul.removeClass("empty");else ul.addClass("empty");for(var i=0;i<items.length;++i){var item=items[i];var node=Catalog.createCatalogNode(item);var li=$($.LI({Class:"catalog-item",id:"catalog-item-"+item.id}));li.append(node);ul.append(li).append(" ")}Catalog.initDetailsHint();$.fn.prepareLinks()},scrollToItems:function(){var target=$("#catalog-toolbar");$("body").animate({scrollTop:target.attr("offsetTop")-9},500)},catalogRequest:null,
requestItems:function(href,options){$.details_hint.close();options=options||{};(options.beforeStart||jQuery.noop)();var catalog_grid_content=$("#catalog-grid-content");catalog_grid_content.addClass("loading");var paginator=$(".paginator");paginator.hide();if(Catalog.catalogRequest)Catalog.catalogRequest.abort();Catalog.catalogRequest=jQuery.getJSON(href,function(data,textStatus,xhr){if(!xhr.status)return;(options.beforeRequest||jQuery.noop)();data=data||{};var status=data.status||"Fail";if(status==
"OK"){Catalog.showLoadedItems(data.items||[]);(options.afterRequest||jQuery.noop)();$("#offer_msg_buy").html(data.offer_msg_buy);$("#offer_msg_trade").html(data.offer_msg_trade)}else alert("Error");catalog_grid_content.removeClass("loading");var s="";var no_paginator=data.no_paginator||false;if(!no_paginator){if(data.page_range.left_end){for(var i in data.page_range.left_end){if(i!="0")s+=" | ";var n=data.page_range.left_end[i];s+='<a href="?p='+n+'">'+n+"</a>"}s+=" ... "}for(var i in data.page_range.range){if(i!=
"0")s+=" | ";var n=data.page_range.range[i];if(n==data.page_number)s+='<span class="current">'+n+"</span>";else s+='<a href="?p='+n+'">'+n+"</a>"}if(data.page_range.right_end){s+=" ... ";for(var i in data.page_range.right_end){if(i!="0")s+=" | ";var n=data.page_range.right_end[i];s+='<a href="?p='+n+'">'+n+"</a>"}}if(s!=""&&data.show_all_link)s+=' | <a href="?p=show%20all">Show All</a>'}paginator.html(s);paginator.show();Catalog.updatePaginatorLinks();(options.afterComplete||jQuery.noop)()})},quickGameSearchIn:(catalogConfig||
{}).quickGameSearchIn||"/catalog/",findGameQuickly:function findGameQuickly(q,params,options){options=options||{};$("#catalog-toolbar-filter li.selected").removeClass("selected");params=params||{};page=parseInt(params.p)||1;q=escape(q);window.urlRouter.quiteInvoke(function(){if(page==1)window.location="#quick-game-finder?q="+q;else window.location="#quick-game-finder?q="+q+"&p="+page});var href=$("#catalog-toolbar-search form").attr("action")+"?q="+q+"&p="+page;Catalog.requestItems(href,options)},
selectFilter:function(filter,params,options){options=options||{};params=params||{};page=params.p||1;window.urlRouter.quiteInvoke(function(){if(page==1)window.location="#"+filter;else window.location="#"+filter+"?p="+page});var quickGameFinder=$("#catalog-toolbar-search input[type=text]");quickGameFinder.wipeSearchBox();var toolbar=$("#catalog-toolbar-filter");toolbar.find("li.selected").removeClass("selected");var a=toolbar.find("a[filterId="+filter+"]");a.parent().addClass("selected");var href=a.attr("href")+
"?p="+page;Catalog.requestItems(href,options)},changePage:function(page){var parts=window.urlRouter.splitLocation(window.location);var anchor=parts[1]||"new-releases";var params=parts[2]||{};params.p=page;var options={beforeStart:Catalog.scrollToItems};if(anchor in Catalog.filtersObject)Catalog.selectFilter(anchor,params,options);else if(anchor==="quick-game-finder"){var q=params.q||"";Catalog.findGameQuickly(q,params,options)}},updatePaginatorLinks:function(){if($("body").hasClass("intro2-page"))return;
var paginator=$(".paginator");paginator.find("a").each(function(){var p=1;$(this).attr("href").match(/\?(.+)$/);var params=RegExp.$1.split("&");for(var i=0;i<params.length;i++){var tmp=params[i].split("=");if(tmp[0]=="p")p=unescape(tmp[1])}$(this).attr("href","#");$(this).click(function(){Catalog.changePage(p);return false})})},getItemHintContent:function(data){var publisher=data.publisher||"",release_date=data.release_date||"",rating=data.rating||"",genres=data.genres||"",ratio=data.ratio||"N/A",
percents=data.percents+"%"||"0%",players=data.number_of_players||"\u2014",cover=data.cover;var res=$($.DIV({Class:"item-hint"},$.DIV({Class:"item-hint-cover"}),$.DIV({Class:"item-hint-data"},$.DL({},$.DT({},"Publisher:"),$.DD({},publisher),$.DT({},"Release:"),$.DD({},release_date),$.DT({},"ESRB:"),$.DD({},rating),$.DT({},"Players:"),$.DD({},players),$.DT({},"Genres:"),$.DD({},genres))),$.DIV({"Class":"item-hint-rating"},$.DIV({"Class":"item-hint-ratio"},ratio),$.DIV({"Class":"item-hint-rating"},$.DIV({"Class":"item-hint-rating-content"},
percents))),$.DIV({"Class":"item-hint-prices"},$.DIV({"Class":"item-hint-price-buy"},"Price: ",$.SPAN({},data.inventory.buy)),$.DIV({"Class":"item-hint-price-trade"},"Trade: ",$.SPAN({},data.inventory.trade)),$.DIV({"Class":"item-hint-price-rent"},"Rent: ",$.SPAN({},data.inventory.rent)))));var cover_div=res.find(".item-hint-cover");if(cover)cover_div.append($.IMG({src:cover,width:170,height:220}));res.find(".item-hint-rating-content").css("width",percents);return res},initDetailsHint:function(){function do_init(selector){$(selector).details_hint({},
function(){var element=$(this),href=element.attr("href")+"hint-details/";jQuery.getJSON(href,function(data){var content=Catalog.getItemHintContent(data);$.details_hint.setContent(element,content)})})}do_init("#catalog-grid-content .catalog-item-cover a");do_init(".games-thumb-list .catalog-item a");do_init("#what-is-my-game-worth-page-content a.item-title")}};Catalog.init();
jQuery(document).ready(function(){var quickGameFinder=$("#catalog-toolbar-search input[type=text]");quickGameFinder.delayChange(function(){var val=$(this).val();if(!val){$(this).blur();Catalog.selectFilter("new-releases");return}Catalog.findGameQuickly(val)}).searchbox("Quick Game Finder");$("#catalog-toolbar-filter a").each(function(index){$(this).parent().prepend('<div class="left-decoration" />').append('<div class="right-decoration" />');var href=$(this).attr("href"),shref=href.split("/");shref.reverse();
var filter=shref.shift()||shref.shift();$(this).attr("filterId",filter).click(function(){Catalog.selectFilter(filter);return false})});var anchor=window.urlRouter.anchor(window.location);var filters=Catalog.filters;for(var i=0;i<filters.length;++i)window.urlRouter.add(filters[i],Catalog.selectFilter);$("#catalog-toolbar-search form").submit(function(){return false});var quick_game_finder=function(anchor,params){params=params||{};var q=params.q||false;var p=parseInt(params.p)||1;if(q){q=decodeURIComponent(q);
quickGameFinder.val(q).removeClass("empty");Catalog.findGameQuickly(q,{p:p})}else Catalog.selectFilter("new-releases")};window.urlRouter.add("quick-game-finder",quick_game_finder).startRoute();$("#catalog-filter-by-genre #catalog-filter-by-genre-current").attachPopup("#catalog-genre-list",{beforeOpen:function(link,pupup){link.hide()},afterClose:function(link){link.show()}});Catalog.updatePaginatorLinks();Catalog.initDetailsHint()});jQuery(document).ready(function(){var toolbar=$("#catalog-toolbar");function div(id){return'<div id="'+id+'"></div>'}toolbar.wrapInner(div("catalog-toolbar-content")).prepend(div("catalog-toolbar-left")).append(div("catalog-toolbar-right"));(function(){var sub=$("#id_sidebar_subscription");var email=sub.find("input[name=email]");email.searchbox("Enter Email Address");sub.submit(function(){var value=email.val();if(!value||!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(value)){email.focus();
alert("Please enter correct email address.");return false}$.get("/Subscription/Subscribe/?email="+value,function(d){if(d.success)$(document).openWizardByUrl("/Subscription/Thank-You/");else{email.focus();alert("Please enter correct email address.")}});return false})})()});var catalogItem={init:function(){catalogItem.prepare_also_on_urls();catalogItem.prepare_get_more_description_url();catalogItem.prepare_get_more_reviews_url();catalogItem.update_member_reviews_list();catalogItem.prepare_screenshots();catalogItem.update_review_links();$("#catalog-item-sidebar .screenshots ul").jcarousel({itemFallbackDimension:40})},update_review_links:function(the_item){var item=the_item;$("a.review-vote-button").click(function(){var href=$(this).attr("href");jQuery.get(href);return false});
if(item){var a=$(".member-reviews-list-actions a.get-more"),href=a.attr("href");if(!href)return;var parts=href.split("/");href=item.url+parts[parts.length-2]+"/";a.attr("href",href)}$("a.reviews-filter").each(function(){var a=$(this),href=a.attr("href");if(item){var parts=href.split("/");href=item.url+parts[parts.length-2]+"/";a.attr("href",href)}a.unbind("click");a.click(function(){jQuery.getJSON(href,function(data,status){if(status!="success")return;var reviews=$(".member-reviews-list");reviews.empty();
for(var i in data.reviews)reviews.append(catalogItem.create_review(data.reviews[i]));catalogItem.update_review_links();if(!data.has_more_reviews)$(".member-reviews-list-actions a.get-more").hide();else $(".member-reviews-list-actions a.get-more").show()});return false})})},update_member_reviews_list:function(){$(".member-reviews-list.not-authenticated li").fadeTo(0,0.3)},prepare_also_on_urls:function(){$(".catalog-item-details .catalog-item-also-on a").each(function(index,item){$(item).click(function(){var a=
$(this),href=a.attr("href");jQuery.getJSON(href+"details/",function(item,status){if(status=="success")catalogItem.display_catalog_item(item)});return false})})},prepare_get_more_description_url:function(){$(".catalog-item-description .get-more").click(function(){var a=$(this),href=a.attr("href");jQuery.getJSON(href,function(data,status){if(status=="success"){a.hide();var div=$(".catalog-item-muze-description").empty().hide();if(data.description.expanded)div.append(data.description.expanded).slideDown()}});
return false})},create_review:function(review){var res=$($.LI({Class:"member-review",id:"member-review-"+review.id},$.DIV({Class:"review-usericon"},$.IMG({src:review.user.icon,width:"60",height:"60"})),$.DIV({Class:"review-content"},$.DIV({Class:"review-comment"}),$.DIV({Class:"review-meta"},$.DIV({Class:"catalog-item-rating"},$.DIV({Class:"catalog-item-rating-content"},review.ratio+"\u00a0of\u00a0100")),$.DIV({Class:"review-author"},review.posted_by)))));if(!review.own_review)res.find(".review-meta").append($.DIV({Class:"review-helpful"},
"Was this helpful?"," ",$.A({Class:"review-vote-button small-yes-button",href:"/Review/Vote/"+review.id+"/yes/"},"Yes")," ",$.A({Class:"review-vote-button small-no-button",href:"/Review/Vote/"+review.id+"/no/"},"No")));if(review.title)res.find(".review-content").prepend("<h4>"+review.title+"</h4>");res.find(".review-comment").append("<p>"+review.comment+"</p>");res.find(".catalog-item-rating-content").css({width:review.ratio+"%"});return res},prepare_get_more_reviews_url:function(){$(".member-reviews-items .member-reviews-list-actions .get-more").click(function(){var a=
$(this),href=a.attr("href"),id=$(".member-reviews-list li:last").attr("id").split("-");id=id[id.length-1];jQuery.getJSON(href,{"id":id},function(data,status){if(status!="success")return;var reviews=$(".member-reviews-list");for(var i in data.reviews)reviews.append(catalogItem.create_review(data.reviews[i]));catalogItem.update_review_links();if(!data.has_more_reviews)a.hide();else a.show()});return false})},set_review_count:function(count){$(".catalog-item-details .review-count").text(count)},set_item_ratio:function(item){var $d=
$(".catalog-item-details"),$s=$("#catalog-item-sidebar");$(".catalog-item-stars .rating").removeClass("stars1 stars2 stars3 stars4 stars5").addClass("stars"+parseInt(item.ratio.percents/20));$(".my.rating").removeClass("stars0 stars1 stars2 stars3 stars4 stars5").addClass("stars"+item.my_rate);$(".rating").each(function(){$(this).find("a").each(function(index,a){$(a).attr("href","/Rate/"+item.id+"/"+(index+1)+"/")})});var rating=$d.find(".catalog-item-stars .catalog-item-rating-content").text("Ratio: "+
item.ratio+"\u00a0of\u00a0100");var w=item.ratio.percents/100*rating.parent().width();rating.animate({width:w});var $r=$s.find(".overall-rating-content");$r.find(".overall-rating-value").text(item.ratio.ratio);var rating_count;if(item.votes.amount==0)rating_count="No review found";else if(item.votes.amount==1)rating_count="Based on 1 review";else rating_count="Based on "+item.votes.amount+" reviews";$r.find(".overall-rating-count").text(rating_count);$(".voters-amount").text(item.votes.amount);function setOverallRating($rd,
stars,value){var p=1*value/(item.votes.amount||1);var bar=$rd.find(".overall-rating-details-"+stars);var w=$rd.find(".ratio-bar").width()*p;var rdc=bar.find(".ratio-bar-content").animate({width:w});bar.find("span").text(value)}var $rd=$r.find(".overall-rating-details");for(var index in item.votes.details)setOverallRating($rd,5-index,item.votes.details[4-index])},update_main_item_properties:function(item){var $d=$(".catalog-item-details"),$p=$d.find(".catalog-item-params"),setValue=function(t,v){$p.find(".catalog-item-params-"+
t+" span").empty().append(v)};if(item.publisher.name)setValue("publisher",'<a href="'+item.publisher.url+'">'+item.publisher.name+"</a>");else setValue("publisher","--");setValue("platform",'<a href="'+item.platform.url+'">'+item.platform.name+"</a>");setValue("release",item.release_date);if(item.genres.length>0){var val="";for(var i in item.genres){if(i!=0)val+=", ";var g=item.genres[i];val+='<a href="'+g.url+'">'+g.name+"</a>"}setValue("genres",val)}else setValue("genres","--");setValue("esrb",
item.esrb||"--");setValue("players",item.number_of_players||"--");setValue("online-players",item.number_of_online_players||"--");if(item.tags.length>0){var val="";for(var i in item.tags){if(i!=0)val+=", ";var t=item.tags[i];val+='<a href="'+t.url+'">'+t.name+"</a>"}setValue("tags",val)}else setValue("tags","--")},display_screen_shots:function(screenshots,media_details){var container=$("#catalog-item-sidebar .screenshots").empty(),div,mediaUrl=catalogConfig.mediaUrl;if(screenshots.length){container.show();
div=$($.DIV({id:"id_screenshots_inner"},$.IMG({Class:"main-image",width:330,height:200,src:mediaUrl+"media/thumbs/muze/330x200/"+screenshots[0].file_name,title:screenshots[0].caption}),$.UL({})));if(media_details)div.find(".main-image").after('<a href="'+media_details+'" class="link-dialog media-details v2">View clip</a>');var ul=div.find("ul");container.append(div);catalogItem.prepare_screenshots(div);ul.jcarousel({size:screenshots.length,itemFallbackDimension:40});var c=ul.data("jcarousel");c.reset();
for(var i in screenshots){var s=screenshots[i];c.add(i,'<li><a href="#'+s.file_name+'"><img src="'+mediaUrl+"media/thumbs/muze/40x25/"+s.file_name+'" width="40" height="25" /></a></li>')}catalogItem.prepare_screenshots(div)}else container.hide()},update_catalog_item_actions:function(item){var ul=$(".catalog-item-actions"),actions=item.actions||{};ul.empty();if(actions.buy){var li=$($.LI({Class:"catalog-item-action-buy"},$.A({href:actions.buy.url,Class:"action link-dialog",title:"Buy"},"Buy"),$.P({},
$.STRONG({},"PRICE"),$.SPAN({Class:"price"}))));li.find("span").html(actions.buy.price);ul.append(li)}if(actions.trade){var li=$($.LI({Class:"catalog-item-action-trade"},$.A({href:actions.trade.url,Class:"action link-dialog",title:"Trade"},"Trade"),$.P({},$.STRONG({},"VALUE"),$.SPAN({Class:"price"}))));li.find("span").html(actions.trade.price);ul.append(li)}if(actions.rent){var li=$($.LI({Class:"catalog-item-action-rent"},$.A({href:actions.rent.url,Class:"action link-dialog",title:"Rent"},"Rent"),
$.P({Class:"message"})));li.find(".message").html(actions.rent.price);ul.append(li)}$.fn.prepareLinks()},display_catalog_item:function(item){var $d=$(".catalog-item-details"),$p=$d.find(".catalog-item-params"),$s=$("#catalog-item-sidebar");$d.find("h1.catalog-item-title").text(item.title);catalogItem.set_item_ratio(item);catalogItem.update_main_item_properties(item);catalogItem.update_catalog_item_actions(item);catalogItem.display_screen_shots(item.screenshots,item.media_details);catalogItem.updateAdvertisement();
var cover=$(".catalog-item-image img").hide();if(item.cover)cover.attr("src",item.cover).show();var also_on=$d.find(".catalog-item-also-on").empty().append("<strong>Also on:</strong> ");for(var index in item.also_on){var i=item.also_on[index];if(index!=0)also_on.append(", ");also_on.append('<a href="'+i.url+'">'+i.name+"</a>")}$d.find(".catalog-item-description").empty().append(item.description).append(' <a href="'+item.url+'muze-description" class="get-more">Read Full Description</a>');catalogItem.prepare_also_on_urls();
catalogItem.set_review_count(item.reviews.count);var member_reviews_items=$d.find(".member-reviews-items").empty();if(item.reviews.items.length>0){var klass="member-reviews-list";if(!item.authenticated)klass+=" not-authenticated";var member_reviews_list=$('<ul class="'+klass+'" />');for(var i in item.reviews.items)member_reviews_list.append(catalogItem.create_review(item.reviews.items[i]));member_reviews_items.append(member_reviews_list);if(item.authenticated&&item.reviews.items.length<item.reviews.count)member_reviews_items.append($.DIV({Class:"member-reviews-list-actions"},
$.A({Class:"get-more",href:item.url+"get-more-reviews/"},"View more reviews...")));catalogItem.update_member_reviews_list();catalogItem.prepare_get_more_reviews_url()}else member_reviews_items.append('<div class="item-reviews-be-first">Be The First To Write A Review!</div>');$(".catalog-item-muze-description").empty();catalogItem.prepare_get_more_description_url();if(item.reviews.form)reviewForm.setContent(item.reviews.form);catalogItem.update_review_links(item);$.fn.prepareLinks()},create_item_thumb:function(item){var li=
$($.LI({},$.DIV({Class:"catalog-item empty"},$.A({href:item.url},item.short_name))));if(item.thumb_image){li.find(".catalog-item").removeClass("empty");li.find(".catalog-item a").empty().append($.IMG({src:item.thumb_image,width:55,height:70}))}return li},previewScreenshot:function(){var a=$(this),img=a.find("img"),src=catalogConfig.mediaUrl+"/media/thumbs/muze/330x200/"+a.attr("href").substring(1);$("#catalog-item-sidebar .main-image").attr("src",img.attr("src")).attr("src",src);return false},prepare_screenshots:function(){var block=
$("#catalog-item-sidebar .screenshots");block.find("li a").click(catalogItem.previewScreenshot).mouseenter(function(){var a=$(this);a.attr("__timeout",setTimeout(function(){catalogItem.previewScreenshot.apply(a,[])},1E3))}).mouseleave(function(){var a=$(this);clearTimeout(a.attr("__timeout"))})},updateAdvertisement:function(){var a=$("#sidebar-advertisement");if(a.size()==0)return;var s=$("#catalog-item-sidebar .screenshots ul").size();if(s){a.data("nivo:vars").stop=true;a.hide()}else{a.show();a.data("nivo:vars").stop=
false}},prepareMediaDialog:function(){$("#item-media-details-sidebar .videos a").each(function(index,a){var a=$(a);a.click(function(){$("#media-viewer").hide();$("#media-player").show();$("#media-player-hilo").show();$("#media-player-hilo a").removeClass("checked");$("#media-player-lo").addClass("checked");var href=$(this).attr("href");href=href.split("-");currentVideoClip=href[href.length-1];$f().stop();$f().play(videoClips[currentVideoClip].f1);return false})});$("#media-player-lo").click(function(){$("#media-player-hilo a").removeClass("checked");
$(this).addClass("checked");$f().play(videoClips[currentVideoClip].f1);return false});$("#media-player-hi").click(function(){$("#media-player-hilo a").removeClass("checked");$(this).addClass("checked");$f().play(videoClips[currentVideoClip].f2);return false});$("#item-media-details-sidebar .screenshots a").each(function(index,a){var a=$(a);a.click(function(){if($("#item-media-details-sidebar .videos a").size())$f().stop();var href=$(this).attr("href");$("#media-player").hide();$("#media-player-hilo").hide();
$("#media-viewer").css("background-image","url("+href+")").show();return false})});var a=$("#item-media-details-sidebar .videos a:first");if(a.size())a.click();else{a=$("#item-media-details-sidebar .screenshots a:first");if(a.size())a.click()}}};
var reviewForm={init:function(){reviewForm.getForm().ajaxForm(reviewForm.options)},getForm:function(){return $(".item-reviews-form form")},setContent:function(form){$(".item-reviews-form").empty().append(form);$.fn.prepareFormWidgets(reviewForm.getForm());Forms.prepare_error_message();reviewForm.init()},options:{beforeSubmit:function(){var f=reviewForm.getForm(),v=f.find("textarea").val();if($.trim(v)===""){alert("Please write a review before continue.");f.find("textarea").focus();return false}v=
f.find(".rating-field input").val();if(v==0){alert("Please rate the game before continue.");return false}reviewForm.getForm().disableForm()},success:function(response,status,xhr,form){reviewForm.getForm().enableForm();if(status!="success")return;reviewForm.setContent(response.form);if(response.status!="errors"){var review=response.review;if($("#member-review-"+review.id).size()==0){if($(".member-reviews-list").size()==0)$(".member-reviews-items").empty().append('<ul class="member-reviews-list"></ul>');
$(".member-reviews-list").prepend(catalogItem.create_review(review));catalogItem.update_review_links()}catalogItem.set_review_count(response.review_count);catalogItem.set_item_ratio(response.item);var target=$("#member-review-"+review.id);$("body").animate({scrollTop:target.attr("offsetTop")},500)}}}};
jQuery(document).ready(function(){catalogItem.init();reviewForm.init();$(".popular-games-by a").each(function(index,a){var a=$(a);a.click(function(){var href=$(this).attr("href");jQuery.getJSON(href,function(data,status){if(status!="success")return;var ul=$(".popular-games .games-thumb-list").empty();for(var i in data.items)ul.append(catalogItem.create_item_thumb(data.items[i]));Catalog.initDetailsHint()});return false})});$("#sidebar-advertisement").nivoSlider({pauseTime:8E3,directionNav:false,controlNav:false});
catalogItem.updateAdvertisement();$("ul.rating a").click(function(){$.get($(this).attr("href"),function(data){catalogItem.set_item_ratio(data)});return false})});

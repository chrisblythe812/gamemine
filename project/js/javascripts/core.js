(function($,window){$.fn.searchbox=function(empty_text){var $this=$(this);$this.attr("_empty_text",empty_text);if($this.val()=="")$.fn.wipeSearchBox.apply($this,[]);$this.focus(function(){var v=$this.val();$this.removeClass("empty");if(v==empty_text)$this.val("")}).blur(function(){var v=$this.val();if(v=="")$.fn.wipeSearchBox.apply($this,[])});return $this};$.fn.wipeSearchBox=function(){input=$(this);input.val(input.attr("_empty_text")||"").addClass("empty");return input}})(jQuery,this);(function(window,undefined){var urlRouter={init:function(){},routes:{},currentLocation:"",timer:null,checkLocation:function(userdata){var location=window.location.toString();if(location!=urlRouter.currentLocation){urlRouter.currentLocation=location;var parts=urlRouter.splitLocation(location);if(parts[1]!=""){var callback=urlRouter.routes[parts[1]]||function(){};callback.apply(null,[parts[1],parts[2],userdata])}}urlRouter.timer=setTimeout(urlRouter.checkLocation,100)},add:function(anchor,callback){urlRouter.routes[anchor]=
callback;return this},quiteInvoke:function(callback){clearTimeout(urlRouter.timer);callback.apply(null);urlRouter.currentLocation=location;urlRouter.startRoute()},startRoute:function(){clearTimeout(urlRouter.timer);urlRouter.timer=setTimeout(urlRouter.checkLocation,100)},anchor:function(location){location=location||urlRouter.currentLocation;return urlRouter.splitLocation(location)[1]},objectToUrlParams:function(o){var oo=[];for(var key in o)oo.push(key+"="+o[key]);return oo.join("&")},splitLocation:function(location){location=
location.toString();var base,anchor,params;var parts=location.split("#");base=parts[0];parts=parts.slice(1).join("#");if(parts!=""){parts=parts.split("?");anchor=parts[0];parts=parts.slice(1).join("?");if(parts!=""){parts=parts.split("&");params=new Object;for(var i=0;i<parts.length;++i){var p=parts[i].split("=");params[p[0]]=p.slice(1).join("=")||true}}}return[base,anchor||"",params]}};urlRouter.init();window.urlRouter=urlRouter})(window);jQuery.fn.topPopup=function(link){var popup=$(this);if(popup.size()==0)return;var timer,showPopup=function(){popup.show();popup.animate({top:"0px"})},hidePopup=function(){clearTimeout(timer);popup.animate({top:-popup.height()},popup.hide)};popup.css("top",-popup.height()).mouseleave(function(){}).mouseenter(function(){clearTimeout(timer)}).find(".top-popup-header a.close-action").click(function(){hidePopup();return false});$(link).click(function(){showPopup();return false})};var Helpers={boxed:function(object,suffix){suffix=suffix||"boxed";object.wrapInner('<div class="'+suffix+'-wrapper"></div>').wrapInner('<div class="'+suffix+'-wrapper-outer"></div>').wrapInner('<div class="'+suffix+'-wrapper-outer-1"></div>').prepend('<div class="'+suffix+'-top"><div class="'+suffix+'-top-left"></div><div class="'+suffix+'-top-right"></div></div>').append('<div class="'+suffix+'-bottom"><div class="'+suffix+'-bottom-left"></div><div class="'+suffix+'-bottom-right"></div></div>')}};
jQuery(document).ready(function(){var ul=$("#content ul.heading");ul.find("li").wrapInner('<div class="wrapper-inner">').wrapInner('<div class="wrapper">');ul.find(".wrapper").prepend('<div class="left-decoration">').append('<div class="right-decoration">');ul.wrap('<div class="ul-heading">');ul.parent().prepend('<div class="left-decoration">').append('<div class="right-decoration">');$("#header-search-box input[type=text]").searchbox("Search");$(".what-is-my-game-worth-page .search-area input[type=text]").searchbox("Title, Publisher, UPC");
$("#header-user-popup").topPopup("#header-user-block-profile");$("#header-login-popup").topPopup("#header-user-block-login");$("#header-signup-popup").topPopup("#header-user-block-signup");$("#page-heading").prepend('<div id="page-heading-decor" />');$(".autoboxed").each(function(){Helpers.boxed($(this))})});jQuery(document).ready(function(){function showSpacefighters(){var cb=$("#colorbox"),cbOffset=cb.offset();function show_obj(obj,ox,oy){obj=$(obj);if(obj.size()!=0){obj.detach();$("body").append(obj);obj.css({top:cbOffset.top+oy,left:cbOffset.left+ox})}}show_obj("#wizard-starfighters",cb.width()-257,-67);show_obj("#wizard-subs-decor-1",7,cb.height()-88);show_obj("#wizard-subs-decor-2",210,-2);show_obj("#wizard-subs-decor-3",520,cb.height()-70);show_obj("#wizard-subs-decor-4",679,100)}function hideSpacefighters(){$("#wizard-starfighters").remove();
$("#wizard-subs-decor-1").remove();$("#wizard-subs-decor-2").remove();$("#wizard-subs-decor-3").remove();$("#wizard-subs-decor-4").remove()}$.fn.setWizardContent=function(data){hideSpacefighters();var w=$(data).attr("width");if(w){$.fn.colorbox.resize({width:w});$.fn.colorbox.setContent(data)}else{$.fn.colorbox.setContent(data);$.fn.colorbox.resize()}prepareAjaxForm();prepareAjaxLinks();showSpacefighters()};function getForm(){return $("#cboxLoadedContent form")}function prepareAjaxForm(){var form=
getForm();form.submit(function(){var validate=$(this).get(0).validate;if(!validate||validate()){$(this).ajaxSubmit(ajaxFormOptions);hideSpacefighters()}return false});form.find(".wizard-back-button").click(function(){form.get(0).validate=null;form.append('<input type="hidden" name="__backward" value="true" />')});$.fn.prepareLinks();$.fn.prepareFormWidgets(getForm());Helpers.boxed(form.find(".boxed"));var cb=$("#colorbox");cb.removeClass("refresh-after-dialog-close");if($("#cboxLoadedContent .refresh-after-dialog-close").size())cb.addClass("refresh-after-dialog-close")}
function prepareAjaxLinks(){$(".wizard-navigate-button").click(function(){$.get($(this).attr("href"),function(data){$.fn.setWizardContent(data)});return false})}var ajaxFormOptions={"beforeSubmit":function(){getForm().disableForm()},"success":function(response,status,xhr,form){if(status!="success"){getForm().enableForm();return}if(response.redirect_to)window.location=response.redirect_to;else if(response.goto_url)$.fn.openWizardByUrl(response.goto_url);else if(response.close)$.fn.colorbox.close();
else if(response.form)$.fn.setWizardContent(response.form);else $.fn.setWizardContent(response)}};var getColorBoxOptions=function(onClose){onClose=onClose||function(element){if($("#colorbox").hasClass("refresh-after-dialog-close")||$(this).hasClass("refresh-after-dialog-close"))window.location=window.location};return{initialWidth:200,initialHeight:100,overlayClose:false,onComplete:function(){var cb=$("#colorbox");if($(this).hasClass("v2"))cb.addClass("v2");else cb.removeClass("v2");prepareAjaxForm();
prepareAjaxLinks();showSpacefighters()},onClosed:function(){hideSpacefighters();onClose.apply(this,[])}}};$.fn.getColorBoxOptions=getColorBoxOptions;$.fn.prepareLinks=function(){$("a.link-dialog:not(.prepared-link-dialog)").each(function(){$(this).addClass("prepared-link-dialog").click(hideSpacefighters).colorbox(getColorBoxOptions())});$("form.link-dialog:not(.prepared-link-dialog-form)").each(function(){$(this).submit(function(){var form=$(this).get(0),$form=$(this);var validate=form.validate;if(!validate||
validate()){var o=getColorBoxOptions();o.href=$form.attr("action");o.post_data=$form.serializeArray();$.colorbox(o)}return false}).addClass("prepared-link-dialog-form")});$("a.dialog-close-button, a.close-button").click(function(){$.fn.colorbox.close();return false})};$.fn.prepareLinks();$.fn.openWizardByUrl=function(href,onClose){var o=getColorBoxOptions(onClose);o.href=href;$.colorbox(o)};$(".link-dialog.autotrigger").click()});var Forms={prepare_error_message:function(){var errorMessage=$(".errors-message");errorMessage.wrapInner('<div class="errors-message-wrapper"></div>').wrapInner('<div class="errors-message-wrapper-outer"></div>').wrapInner('<div class="errors-message-wrapper-outer-1"></div>').prepend('<div class="errors-message-top"><div class="errors-message-top-left"></div><div class="errors-message-top-right"></div></div>').append('<div class="errors-message-bottom"><div class="errors-message-bottom-left"></div><div class="errors-message-bottom-right"></div></div>')}};
jQuery(document).ready(function(){$.fn.prepareFormWidgets();$.fn.delayChange=function(callback,timeout){timeout=timeout||500;var timer,input=$(this),value=input.val(),resetTimeout=function(){clearTimeout(timer)},runCallback=function(){if(value==input.val())return;value=input.val();callback.apply(input)},delayCallback=function(){timer=setTimeout(runCallback,timeout)};input.keyup(function(){resetTimeout();delayCallback()});return input};Forms.prepare_error_message();function selectionChanged(sel){$(this).prev().find("span").text($(this).find("option:selected").text())}
$.fn.setupSelect=function(klass){klass=klass||"";this.wrap('<div class="select '+klass+'"><div class="select-inner"></div></div>').each(function(){$(this).parent().prepend('<div class="text"><div class="text-wrapper"><span></span></div></div>');selectionChanged.call(this)}).change(selectionChanged);if($.browser.msie)this.keyup(selectionChanged)};$.fn.updateValue=function(){this.change()}});var Cart={init:function(){Cart.updateCartActions();Cart.init_list_actions();Cart.init_quantity_inputs()},updateCartContent:function(data){$(".cart-link").text("Cart ("+data.cart.size+")");$("#cart-heading .total").empty().text("Total: "+data.cart.total);$("#cart-index-content").empty().append(data.html);Cart.updateCartActions();Cart.init_quantity_inputs();$.fn.prepareLinks()},init_quantity_inputs:function(){$(".quantity-input").keydown(function(event){if(!(event.keyCode==13||event.keyCode==46||event.keyCode==
8||event.keyCode==9||event.keyCode>=48&&event.keyCode<=57))event.preventDefault()})},updateCartActions:function(){var parseAction=function(href){var pieces=href.split("/"),len=pieces.length,action=pieces[len-3],id=pieces[len-2];return{action:action,id:id}},action=function(){var a=parseAction($(this).data("cart-action-href"));if(a.action=="Add")Cart.addItem(a.id);else if(a.action=="Remove")Cart.removeItem(a.id);return false};$("a.cart-action-remove").each(function(){var a=$(this);if(!a.data("cart_action_initialized")){var aa=
parseAction(a.attr("href"));a.data("cart-action-href",a.attr("href"));a.click(action).attr("href","/Cart/#"+aa.action);a.data("cart_action_initialized",true)}});var ajaxFormOptions={"beforeSubmit":function(){$(this).disableForm()},"success":function(data,status,xhr,form){if(status!="success"){$(this).enableForm();return}if(data.redirect_to){window.location=data.redirect_to;return}Cart.updateCartContent(data)}};$(".cart-table-form").submit(function(){$(this).ajaxSubmit(ajaxFormOptions);return false});
$(".cart-table-form .submit").click(function(){$(this).parents("form").submit();return false})},addItem:function(id){},removeItem:function(id){jQuery.getJSON("/Cart/Remove/"+id+"/",function(data,status){if(status!="success")return;if(data.redirect_to){window.location=data.redirect_to;return}Cart.updateCartContent(data)})},init_list_actions:function(){$("#buy-list-grid .buy-list-action").each(function(index,a){$(a).data("_action",$(a).attr("href")).attr("href","#").click(function(){var href=$(this).data("_action");
jQuery.getJSON(href,function(data,status){if(status!="success")return;$("#buy-list-grid").empty().append(data.html);$(".buy-list-size").empty().text(data.buy_list.size);$(".lists-size").empty().text(data.lists_size);Cart.init_list_actions()});return false})})}};$(document).ready(function(){Cart.init()});var Rent={init:function(){Rent.init_list_actions();Rent.init_search_widget()},init_list_actions:function(){$(".list-page .rating a").click(function(){var a=$(this),href=a.attr("href");jQuery.getJSON(href,function(data,status){if(status!="success")return;a.parents("ul.rating").removeClass("stars0 stars1 stars2 stars3 stars4 stars5").addClass("stars"+data.ratio.rating)});return false});$(".rent-list-action").each(function(index,a){$(a).data("_action",$(a).attr("href")).attr("href","#").click(function(){var href=
$(this).data("_action");jQuery.getJSON(href,function(data,status){if(status!="success")return;if(data.message){alert(data.message);return}$("#rent-list-grid").empty().append(data.html);$(".rent-list-size").empty().text(data.rent_list.size);$(".lists-size").empty().text(data.lists_size);Rent.init_list_actions()});return false})});var disableDnD;$(".item-notes a").each(function(index,a){var a=$(a);a.click(function(){return false});a.editable(a.attr("href"),{name:"notes",width:150,height:18,placeholder:"add note",
onblur:"submit",onedit:function(){disableDnD=true},onsubmit:function(){disableDnD=false},onreset:function(){disableDnD=false}})});$(".rent-list-page #rent-list-table").tableDnD({onDragClass:"dragging",onDrop:function(table,row){if(disableDnD){$(".item-notes input").blur();return}row=$(row);var rowId=row.attr("id");$(table).find("tr").each(function(index,r){if($(r).attr("id")==rowId){var id=rowId.split("-")[2],href="/Rent/Move-To/"+id+"/"+(index-1)+"/";jQuery.getJSON(href,function(data,status){if(status!=
"success")return;$("#rent-list-grid").empty().append(data.html);$(".rent-list-size").empty().text(data.rent_list.size);Rent.init_list_actions()});return false}})}})},init_search_widget:function(){$('.list-page #add-by-upc-widget input[type="text"]').each(function(index,input){$(input).searchbox("Enter Game Title or UPC").autocomplete("/Search/By-UPC/",{maxItemsToShow:5,matchContains:1,width:500,onItemSelect:function(li){if(li==null)return;$(input).wipeSearchBox();var id=li.extra[0],loc=window.location.toString(),
action=null;if(/\/Rent\/List\/$/.test(loc))action="/Rent/Add/"+id+"/";else if(/\/Trade\/List\/$/.test(loc))action="/Trade/Add/"+id+"/";else if(/\/Buy\/List\/$/.test(loc))action="/Cart/Add/"+id+"/";else return;$.fn.openWizardByUrl(action)}})})}};$(document).ready(function(){Rent.init();var total=$("#list-banner-rotator img").length;var rand=Math.floor(Math.random()*total);$("#list-banner-rotator").nivoSlider({pauseTime:8E3,directionNav:false,controlNav:false,startSlide:rand})});var Trade={init:function(){Trade.init_list_actions()},init_list_actions:function(){$("#trade-list-grid .trade-list-action").each(function(index,a){$(a).data("_action",$(a).attr("href")).attr("href","#").click(function(){var href=$(this).data("_action");jQuery.getJSON(href,function(data,status){if(status!="success")return;$("#trade-list-grid").empty().append(data.html);$(".trade-list-size").empty().text(data.trade_list.size);$(".lists-size").empty().text(data.lists_size);Trade.init_list_actions()});
return false})})}};$(document).ready(function(){Trade.init()});var Search={init:function(){Search.init_links()},init_links:function(){$("#search-results .paginator a").click(function(){$("#search-results").empty().addClass("loading");var a=$(this);jQuery.get(a.attr("href"),function(data,status){if(status!="success")return;$("#search-results").removeClass("loading").append(data);Search.init_links()});return false});$(".subinfo select").change(function(){$("#search-results").empty().addClass("loading");var s=$(this),loc=window.location;jQuery.post(loc,{order_by:s.val()},
function(data,status){if(status!="success")return;$("#search-results").removeClass("loading").append(data);Search.init_links()})});$.fn.prepareLinks()}};$(document).ready(function(){Search.init()});var OloloSearch={init:function(){OloloSearch._input=$("#header-search-box input[type=text]");OloloSearch._input.delayChange(function(){var val=$.trim($(this).val());if(val===""){OloloSearch.cancelSearch();return}OloloSearch.search(val)}).blur(function(){setTimeout(OloloSearch.cancelSearch,500)})},_input:null,_ajaxRequest:null,_container:null,cancelRequest:function(){if(OloloSearch._ajaxRequest){OloloSearch._ajaxRequest.abort();OloloSearch._ajaxRequest=null}},cancelSearch:function(){OloloSearch.cancelRequest();
OloloSearch.getResultsContainer().hide()},search:function(q){OloloSearch.cancelRequest();var href="/Search/Quick/?q="+q;OloloSearch.getResultsContainer().find("#ololo-results-footer a").attr("href","/Search/?q="+q);OloloSearch._ajaxRequest=jQuery.getJSON(href,function(data,status){if(!data)return;OloloSearch.displayItems(data.items);OloloSearch._ajaxRequest=null})},displayItems:function(items){function getItemDisplay(item){return $($.LI({},$.A({href:item.url},$.IMG({src:item.icon}),$.SPAN({Class:"title"},
item.title),$.SPAN({Class:"upc"},item.upc),$.SPAN({Class:"release-date"},item.release_date))))}var container=OloloSearch.getResultsContainer(),ul=container.find("ul");ul.empty();for(i in items)ul.append(getItemDisplay(items[i]));container.show()},getResultsContainer:function(){if(OloloSearch._container)return OloloSearch._container;OloloSearch._container=$($.DIV({id:"ololo-results-popup"},$.UL({}),$.DIV({id:"ololo-results-footer"},$.A({href:"#"},"View All Search Results"))));OloloSearch._container.hide();
var inputOffset=OloloSearch._input.offset();OloloSearch._container.css({left:inputOffset.left+OloloSearch._input.width()-260+8,top:inputOffset.top+OloloSearch._input.height()+5});$("body").append(OloloSearch._container);return OloloSearch._container}};$(document).ready(function(){OloloSearch.init()});var Profile={init:function(){Profile.init_grid_actions()},init_grid_actions:function(){$(".profile-page-with-grid .page-with-grid-content a.grid-action").click(function(){var href=$(this).attr("href");jQuery.getJSON(href,function(data,status){if(status!="success")return;var c=$(".profile-page-with-grid .page-with-grid-content");c.find("table").remove();c.append(data.table);Profile.init_grid_actions()});return false})}};$(document).ready(function(){Profile.init()});function setupCCVTooltip($link,$hint,$cardtype){$link.click(function(){return false}).tooltip({relative:true,onBeforeShow:function(){var cardtype=$cardtype.val();if(cardtype=="visa"||cardtype=="master-card"){$hint.find(".picture").css("background","0 0 url("+siteConfig.mediaUrl+"img/ccv-explained.png)");$hint.find(".description").text("The CVV number is the last three digits listed in the signature area on the back of the card.")}else if(cardtype=="american-express"){$hint.find(".picture").css("background",
"0 -69px url("+siteConfig.mediaUrl+"img/ccv-explained.png)");$hint.find(".description").text("The CVV number is listed above the credit card number on the front of the card.")}else return false}})};(function($){$.fn.balalaykaBanner=function(options){var settings=$.extend({},$.fn.balalaykaBanner.defaults,options||{}),cls=settings.balalaykaClass;var Balalayka=function(banner){var timer,balalayka={buidSidebarItem:function(d){var res=$('<li class="'+cls+'-sidebar-item" style="background-image: url('+d.images[1]+')"></li>');res.data("balalayka:object",d);return res},setBannerContent:function(d){var back=banner.find("."+cls+"-banner-background"),fore=banner.find("."+cls+"-banner-foreground");back.css("background-image",
"url("+d.images[0]+")");fore.fadeOut(settings.animationSpeed,function(){fore.empty().css("background-image","url("+d.images[0]+")").show();for(var i=0;i<d.links.length;++i){var klass=d.banner_class+" "+cls+"-banner-link "+cls+"-banner-link-"+i;if(d.links[i][1])klass+=" "+d.links[i][1];var a=$('<a href="'+d.links[i][0]+'" class="'+klass+'"> </a>');if(d.links[i][0]=="#")a.click(function(){return false});fore.append(a)}$.fn.prepareLinks()})},start:function(){if(timer)clearInterval(timer);timer=setInterval(balalayka.next,
settings.pauseTime)},next:function(){balalayka.pause();var sidebar=banner.find("."+cls+"-sidebar-items"),first=sidebar.find("."+cls+"-sidebar-item:first");balalayka.setBannerContent(first.data("balalayka:object"));sidebar.animate({marginTop:"-"+settings.itemHeight+"px"},settings.animationSpeed,function(){sidebar.css("margin-top","0px");first.appendTo("."+cls+"-sidebar-items");balalayka.resume()})},pause:function(){clearInterval(timer);timer=null},resume:function(){balalayka.start()},preload:function(d){(new Image).src=
d.images[0];(new Image).src=d.images[1]}};return balalayka};return this.each(function(){var banner=$(this),vars={balalayka:Balalayka(banner),paused:false};banner.data("balalayka:vars",vars);banner.addClass(cls);banner.empty().append('<div class="banner-header"></div><div class="'+cls+'-content"><div class="'+cls+'-banner"><div class="'+cls+'-banner-background"><div class="'+cls+'-banner-foreground"></div></div></div><div class="'+cls+'-sidebar"></div><a href="#" class="'+cls+'-sidebar-next-link"></a></div>');
var content=banner.find("."+cls+"-content");content.hide();$.get(settings.url+"?"+Math.floor(1E7*Math.random()),function(data,status){if(status!="success")return;var sidebarItems=$('<ul class="'+cls+'-sidebar-items"></ul>');for(var i=0;i<data.banners.length;++i){vars.balalayka.preload(data.banners[i]);sidebarItems.append(vars.balalayka.buidSidebarItem(data.banners[i]))}banner.find("."+cls+"-sidebar").empty().append(sidebarItems);var next_link=banner.find("."+cls+"-sidebar-next-link").click(function(){vars.balalayka.next();
return false}).hide();next_link.mouseenter(function(){next_link.addClass("mouse-over")}).mouseleave(function(){next_link.removeClass("mouse-over")});banner.find("."+cls+"-sidebar-items").mouseenter(function(){next_link.fadeIn()}).mouseleave(function(){setTimeout(function(){if(!next_link.hasClass("mouse-over"))next_link.fadeOut()},500)});vars.balalayka.setBannerContent(data.banners[data.banners.length-1],data.banners[0]);content.fadeIn(settings.animationSpeed,function(){vars.balalayka.start()})})})};
$.fn.balalaykaBanner.defaults={pauseTime:8500,balalaykaClass:"balalayka",itemHeight:115,animationSpeed:500}})(jQuery);
